"use strict";const t=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),o=require("../../../uv-ui-tools/libs/mixin/mixin.js"),s=require("./colors.js"),e=require("./props.js"),i=require("../../../../common/vendor.js"),h={name:"uv-pick-color",emits:["confirm","cancel","close","change"],mixins:[t.mpMixin,o.mixin,e.props],computed:{pointerStyle(){const t={};return t.top=this.$uv.addUnit(this.site[0].top-8),t.left=this.$uv.addUnit(this.site[0].left-8),t}},data:()=>({showToolbar:!1,rgba:{r:0,g:0,b:0,a:1},hsb:{h:0,s:0,b:0},site:[{top:0,left:0},{left:0},{left:0}],index:0,bgcolor:{r:255,g:0,b:0,a:1},hex:"#000000",mode:!0,colorList:s.colorList}),watch:{prefabColor(t){this.colorList=t}},created(){this.rgba=this.color,this.prefabColor.length&&(this.colorList=this.prefabColor)},methods:{open(){this.$refs.pickerColorPopup.open(),this.showToolbar=!0,this.$nextTick((async()=>{await this.$uv.sleep(350),this.getSelectorQuery()}))},close(){this.$refs.pickerColorPopup.close()},popupChange(t){t.show||this.$emit("close")},cancelHandler(){this.$emit("cancel"),this.close()},confirmHandler(){this.$emit("confirm",{rgba:this.rgba,hex:this.hex}),this.close()},init(){this.hsb=s.rgbToHsb(this.rgba),this.setValue(this.rgba)},async getSelectorQuery(){const t=await this.$uvGetRect(".drag-box",!0);this.position=t,this.setColorBySelect(this.rgba)},select(){this.mode=!this.mode},touchstart(t,o){const{clientX:s,clientY:e}=t.touches[0];this.pageX=s,this.pageY=e,this.setPosition(s,e,o)},touchmove(t,o){const{clientX:s,clientY:e}=t.touches[0];this.moveX=s,this.moveY=e,this.setPosition(s,e,o)},touchend(t,o){},setPosition(t,o,s){this.index=s;const{top:e,left:i,width:h,height:r}=this.position[s];this.site[s].left=Math.max(0,Math.min(parseInt(t-i),h)),0===s?(this.site[s].top=Math.max(0,Math.min(parseInt(o-e),r)),this.hsb.s=parseInt(100*this.site[s].left/h),this.hsb.b=parseInt(100-100*this.site[s].top/r),this.setColor(),this.setValue(this.rgba)):this.setControl(s,this.site[s].left)},setColor(){const t=s.hsbToRgb(this.hsb);this.rgba.r=t.r,this.rgba.g=t.g,this.rgba.b=t.b},setValue(t){this.hex=`#${s.rgbToHex(t)}`},setControl(t,o){const{top:e,left:i,width:h,height:r}=this.position[t];1===t?(this.hsb.h=parseInt(360*o/h),this.bgcolor=s.hsbToRgb({h:this.hsb.h,s:100,b:100}),this.setColor()):this.rgba.a=+(o/h).toFixed(1),this.setValue(this.rgba)},setColorBySelect(t){const{r:o,g:e,b:i,a:h}=t;let r={};r={r:o?parseInt(o):0,g:e?parseInt(e):0,b:i?parseInt(i):0,a:h||0},this.rgba=r,this.hsb=s.rgbToHsb(r),this.changeViewByHsb()},changeViewByHsb(){const[t,o,e]=this.position;this.site[0].left=parseInt(this.hsb.s*t.width/100),this.site[0].top=parseInt((100-this.hsb.b)*t.height/100),this.setColor(this.hsb.h),this.setValue(this.rgba),this.bgcolor=s.hsbToRgb({h:this.hsb.h,s:100,b:100}),this.site[1].left=this.hsb.h/360*o.width,this.site[2].left=this.rgba.a*e.width}}};if(!Array){(i.resolveComponent("uv-toolbar")+i.resolveComponent("uv-popup"))()}Math||((()=>"../../../uv-toolbar/components/uv-toolbar/uv-toolbar.js")+(()=>"../../../uv-popup/components/uv-popup/uv-popup.js"))();const r=i._export_sfc(h,[["render",function(t,o,s,e,h,r){return i.e({a:i.o(r.cancelHandler),b:i.o(r.confirmHandler),c:i.p({show:h.showToolbar,cancelColor:t.cancelColor,confirmColor:t.confirmColor,cancelText:t.cancelText,confirmText:t.confirmText,title:t.title,"show-border":!0}),d:i.s(r.pointerStyle),e:i.o((t=>r.touchstart(t,0))),f:i.o((t=>r.touchmove(t,0))),g:i.o((t=>r.touchend(t,0))),h:`rgb(${h.bgcolor.r},${h.bgcolor.g},${h.bgcolor.b})`,i:`rgba(${h.rgba.r},${h.rgba.g},${h.rgba.b},${h.rgba.a})`,j:t.$uv.getPx(h.site[1].left-10,!0),k:i.o((t=>r.touchstart(t,1))),l:i.o((t=>r.touchmove(t,1))),m:i.o((t=>r.touchend(t,1))),n:t.$uv.getPx(h.site[2].left-10,!0),o:i.o((t=>r.touchstart(t,2))),p:i.o((t=>r.touchmove(t,2))),q:i.o((t=>r.touchend(t,2))),r:i.o(((...t)=>r.select&&r.select(...t))),s:h.mode},h.mode?{t:i.t(h.hex)}:{v:i.t(h.rgba.r),w:i.t(h.rgba.g),x:i.t(h.rgba.b),y:i.t(h.rgba.a)},{z:i.f(h.colorList,((t,o,s)=>({a:`rgba(${t.r},${t.g},${t.b},${t.a})`,b:i.o((o=>r.setColorBySelect(t)),o),c:o}))),A:i.sr("pickerColorPopup","e97c28a0-0"),B:i.o(r.popupChange),C:i.p({mode:"bottom","close-on-click-overlay":t.closeOnClickOverlay})})}],["__scopeId","data-v-e97c28a0"]]);wx.createComponent(r);
